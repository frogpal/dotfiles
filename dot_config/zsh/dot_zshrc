# Performance optimization: Skip global compinit for faster startup
# skip_global_compinit=1 # I probably don't need this

# History settings
setopt APPEND_HISTORY
setopt SHARE_HISTORY
setopt HIST_IGNORE_SPACE
setopt HIST_IGNORE_ALL_DUPS
setopt HIST_VERIFY
setopt HIST_REDUCE_BLANKS
setopt HIST_FIND_NO_DUPS
unsetopt PROMPT_SP

autoload -U colors && colors
zstyle ':completion:*' matcher-list 'm:{a-z}={A-Za-z}'
zstyle ':completion:*' list-colors '${(s.:.)LS_COLORS}'
# zstyle ':completion:*:descriptions' format '%F{cyan}%d%f'
zstyle ':completion:*:descriptions' format '[%d]'
zstyle ':completion:*:warnings' format ' %F{red}-- no matches found --%f'

zstyle ':completion:*:git-checkout:*' sort false
zstyle ':completion:*' menu no
zstyle ':fzf-tab:complete:cd:*' fzf-preview 'ls --color=always $realpath'

# Make word movement behave like text editors
autoload -U select-word-style
select-word-style bash

# Key bindings for command history navigation
bindkey "^[[A" history-search-backward
bindkey "^[[B" history-search-forward
bindkey "^[[1;5C" forward-word
bindkey "^[[1;5D" backward-word
bindkey "^[[3~" delete-char # delete characters using the "delete" key
bindkey "^C" autosuggest-clear

# PATH management
typeset -U PATH  # Remove duplicates from PATH

# Aliases
alias get-music="yt-dlp -x -f bestaudio --audio-format mp3 --embed-thumbnail"
alias music="cd $HOME/Folders/Personal/Music"

alias ls='ls --color=auto'
# Add completions to fpath
# if [[ -d "$ZSH_PLUGINS_DIR/zsh-completions/src" ]]; then
#     fpath=("$ZSH_PLUGINS_DIR/zsh-completions/src" $fpath)
# fi

# Initialize completions
autoload -Uz compinit
# Only run compinit once per day for better performance
if [[ -n ${ZDOTDIR}/.zcompdump(#qN.mh+24) ]]; then
    compinit
else
    compinit -C
fi

plugins=(
    "zsh-autosuggestions.zsh"
    "zsh-syntax-highlighting/zsh-syntax-highlighting.zsh"
    "colored-man-pages.plugin.zsh"
    "colorize.plugin.zsh"
    "fzf-tab/fzf-tab.plugin.zsh"
)

for plugin in "${plugins[@]}"; do
    plugin_path="$ZSH_PLUGINS_DIR/$plugin"
    [[ -r "$plugin_path" ]] && source "$plugin_path"
done

# fzf integration (if available)
if command -v fzf &> /dev/null; then
    source <(fzf --zsh)
fi

if command -v starship &> /dev/null; then
    export STARSHIP_CONFIG=$XDG_CONFIG_HOME/starship/starship.toml
    eval "$(starship init zsh)"
fi

# eval "$(starship init zsh)"
